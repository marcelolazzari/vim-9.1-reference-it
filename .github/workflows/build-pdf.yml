name: Build PDFs (Docker pandoc)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show repo files
        run: ls -la

      - name: Build PDFs using pandoc/latex Docker image
        env:
          WORKDIR: ${{ github.workspace }}
        run: |
          # run pandoc inside the pandoc/latex docker image, mounting the repo
          docker run --rm -v "${GITHUB_WORKSPACE}:/data" -w /data pandoc/latex:3.1 \
            sh -c "pandoc vim-9.1-reference-it.md -o 'Vim-9.1-Reference-IT.pdf' --pdf-engine=xelatex -V geometry:margin=1in -V mainfont='DejaVu Sans Mono' --highlight-style=tango && \
                   pandoc vim-cheatsheet-it.md -o 'Vim-Cheatsheet-IT.pdf' --pdf-engine=xelatex -V geometry:margin=0.7in -V mainfont='DejaVu Sans Mono'"

      - name: Upload PDFs
        uses: actions/upload-artifact@v4
        with:
          name: vim-pdfs
          path: |
            Vim-9.1-Reference-IT.pdf
            Vim-Cheatsheet-IT.pdf
